<%- include("partials/header", { title: "Booking History", bodyClass: "dashboard-bg" }) %>
<%- include("partials/navbar", { user: user }) %>

<div class="container container-max py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="mb-0">Booking & Payment History</h3>
    <a href="/storage" class="btn btn-outline-primary btn-sm">Browse Storage</a>
  </div>


  <div class="card shadow-soft">
    <div class="table-responsive">
      <table class="table table-striped mb-0">
        <thead class="table-light">
          <tr>
            <th>Type</th>
            <th>Ref</th>
            <th>Item</th>
            <th>Dates</th>
            <th class="text-end">Total</th>
            <th>Status</th>
            <th>Payment</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% if (!combined || combined.length === 0) { %>
            <tr><td colspan="8" class="text-center py-4 text-muted">No history yet.</td></tr>
          <% } else { %>
            <% combined.forEach(r => { %>
              <tr>
                <td class="text-muted"><%= r.type %></td>
                <td><%= r.ref %></td>
                <td>
                  <div class="fw-semibold"><%= r.title %></div>
                  <% if (r.location || r.size) { %>
                    <div class="small text-muted"><%= r.location || 'N/A' %> | <%= r.size || '' %></div>
                  <% } %>
                </td>
                <td>
                  <%= (r.startDate || '').toISOString ? r.startDate.toISOString().slice(0,10) : r.startDate %>
                  to
                  <%= (r.endDate || '').toISOString ? r.endDate.toISOString().slice(0,10) : r.endDate %>
                </td>
                <td class="text-end fw-semibold">$<%= Number(r.total || 0).toFixed(2) %></td>
                <td><span class="badge text-bg-secondary"><%= r.status %></span></td>
                <td>
                  <div class="small"><%= r.paymentMethod || 'N/A' %></div>
                  <div class="small text-muted"><%= r.paymentDate ? new Date(r.paymentDate).toISOString().slice(0,19).replace('T',' ') : '' %></div>
                </td>
                <td class="text-end">
                  <% if (r.viewLink) { %>
                    <a href="<%= r.viewLink %>" class="btn btn-sm btn-outline-secondary">View</a>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<%- include("partials/footer") %>


