<%- include("partials/header", { title: "Provider Calendar" }) %>
<%- include("partials/navbar", { user: user }) %>

<div class="container container-max py-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-1">Booking Calendar</h3>
      <div class="small-muted">Track your bookings by date.</div>
    </div>
    <a class="btn btn-outline-dark btn-sm" href="/provider/dashboard">Back to Dashboard</a>
  </div>

  <div class="card shadow-soft p-3">
    <div id="providerCalendar"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script>
  const bookings = <%- JSON.stringify(bookings || []) %>;
  const events = bookings.map(b => {
    const endDate = b.end_date ? new Date(b.end_date) : null;
    if (endDate) endDate.setDate(endDate.getDate() + 1);
    return {
      title: `${b.storage_title} â€¢ ${b.customer_name}`,
      start: b.start_date,
      end: endDate ? endDate.toISOString().slice(0, 10) : null,
      color: b.status === 'Cancelled' ? '#dc2626' : '#0f6433'
    };
  });

  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('providerCalendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 'auto',
      events,
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek'
      }
    });
    calendar.render();
  });
</script>

<%- include("partials/footer") %>
