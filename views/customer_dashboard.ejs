<%- include("partials/header", { title: "Customer Dashboard", bodyClass: "dashboard-bg" }) %>
<%- include("partials/navbar", { user: user }) %>

<style>
  :root {
    --tone-1-darkest: #2F6B6A;
    --tone-2-darker: #3D7675;
    --tone-3-medium: #4A8B8A;
    --tone-4-light: #6BA8A7;
    --tone-5-lightest: #A8D4D1;
    --cream-bg: #F0EDE5;
  }

  .btn-browse {
    background: linear-gradient(135deg, #4ECDC4 0%, #45B7B0 100%);
    color: white !important;
    border: none;
  }

  .btn-browse:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(78, 205, 196, 0.4);
  }

  .view-cart-btn {
    background: linear-gradient(135deg, #4ECDC4 0%, #45B7B0 100%);
    border: none;
    border-radius: 12px;
    padding: 12px 30px;
    font-weight: 600;
    color: white;
    transition: all 0.3s ease;
  }

  .view-cart-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(78, 205, 196, 0.4);
  }

  .welcome-header {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
    color: #1a1a1a;
    font-size: 42px;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .welcome-subtitle {
    color: #4a4a4a;
    font-size: 16px;
    text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
  }

  .glass-card {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    padding: 35px;
    transition: all 0.3s ease;
  }

  .glass-card:hover {
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
    transform: translateY(-5px);
  }

  .card-title {
    font-size: 24px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 20px;
  }

  .action-btn {
    padding: 14px 24px;
    border-radius: 12px;
    font-weight: 600;
    border: 2px solid transparent;
    transition: all 0.3s ease;
    text-align: center;
    display: block;
    text-decoration: none;
  }

  .btn-browse {
    background: linear-gradient(135deg, var(--tone-2-darker) 0%, var(--tone-3-medium) 100%);
    color: white !important;
    border: none;
  }

  .btn-browse:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(47, 107, 106, 0.4);
  }

  .btn-manage {
    background: white;
    color: var(--tone-2-darker) !important;
    border: 2px solid #e2e8f0;
  }

  .btn-manage:hover {
    background: #f7fafc;
    border-color: #cbd5e0;
    transform: translateY(-2px);
  }

  .btn-logout {
    background: white;
    color: #e53e3e !important;
    border: 2px solid #fc8181;
  }

  .btn-logout:hover {
    background: #fff5f5;
    border-color: #e53e3e;
    transform: translateY(-2px);
  }

  .view-cart-btn {
    background: linear-gradient(135deg, var(--tone-2-darker) 0%, var(--tone-3-medium) 100%);
    border: none;
    border-radius: 12px;
    padding: 12px 30px;
    font-weight: 600;
    color: white;
    transition: all 0.3s ease;
  }

  .view-cart-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(47, 107, 106, 0.4);
  }
</style>

<div class="container container-max py-5">
  <div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h3 class="welcome-header">Welcome, <%= user.name %></h3>
      <div class="welcome-subtitle">Manage your saved storage items and bookings.</div>
    </div>
    <a href="/cart" class="btn view-cart-btn">
      View Cart
      <% if (typeof cartCount !== 'undefined') { %>
        <span class="badge bg-light text-dark ms-2"><%= cartCount %></span>
      <% } %>
    </a>
  </div>

  <div class="row g-4">
    <div class="col-lg-7">
      <div class="glass-card h-100">
        <h5 class="card-title">ðŸ“¦ Cart Preview</h5>

        <% if (!preview || preview.length === 0) { %>
          <p class="mb-4" style="color: #718096;">Your cart is empty. Browse storage spaces and add what you like.</p>
          <div class="mt-3">
            <a href="/storage" class="action-btn btn-browse">Browse Storage</a>
          </div>
        <% } else { %>
          <div class="list-group">
            <% preview.forEach(i => { %>
              <div class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div class="fw-semibold"><%= i.title %></div>
                  <div class="small text-muted"><%= i.size %> â€¢ <%= i.location || 'N/A' %></div>
                </div>
                <div class="text-end">
                  <div class="fw-semibold">x<%= i.quantity %></div>
                  <div class="small text-muted">$<%= Number(i.unit_price).toFixed(2) %>/day</div>
                </div>
              </div>
            <% }) %>
          </div>
          <div class="mt-4 d-flex gap-3">
            <a href="/cart" class="action-btn btn-browse flex-fill">Go to Cart</a>
            <a href="/storage" class="action-btn btn-manage flex-fill">Add More</a>
          </div>
        <% } %>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="glass-card">
        <h5 class="card-title">âš¡ Quick Actions</h5>
        <div class="d-grid gap-3">
          <a href="/storage" class="action-btn btn-browse">ðŸ“¦ Browse Storage</a>
          <a href="/cart" class="action-btn btn-manage">ðŸ›’ Manage Cart</a>
          <a href="/logout" class="action-btn btn-logout">ðŸšª Logout</a>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include("partials/footer") %>
